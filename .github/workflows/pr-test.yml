name: Pull Request Tests

on:
  pull_request:
    branches:
      - main

jobs:
  validate-title:
    name: Validate PR Title
    runs-on: ubuntu-latest
    
    steps:
      - name: Check PR title format
        run: |
          PR_TITLE="${{ github.event.pull_request.title }}"
          if [[ ! "$PR_TITLE" =~ ^(Major|Minor|Patch):\ .+ ]]; then
            echo "❌ PR title must start with 'Major: ', 'Minor: ', or 'Patch: '"
            echo "Current title: $PR_TITLE"
            echo ""
            echo "Examples:"
            echo "  - Major: Breaking change to API"
            echo "  - Minor: Add new feature"
            echo "  - Patch: Fix bug in validation"
            exit 1
          fi
          echo "✅ PR title format is valid"
  
  test:
    name: Run Tests
    runs-on: ubuntu-latest
    needs: validate-title
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      
      - name: Set up Go
        uses: actions/setup-go@v5
        with:
          go-version-file: 'go.mod'
          cache: true
      
      - name: Download dependencies
        run: go mod download
      
      - name: Verify dependencies
        run: go mod verify
      
      - name: Run tests
        run: make test
      
      - name: Run vet
        run: go vet ./...
